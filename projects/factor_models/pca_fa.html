<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Reis">

<title>Componentes Principais e Análise Fatorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="pca_fa_files/libs/clipboard/clipboard.min.js"></script>
<script src="pca_fa_files/libs/quarto-html/quarto.js"></script>
<script src="pca_fa_files/libs/quarto-html/popper.min.js"></script>
<script src="pca_fa_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pca_fa_files/libs/quarto-html/anchor.min.js"></script>
<link href="pca_fa_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pca_fa_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pca_fa_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pca_fa_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pca_fa_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Componentes Principais e Análise Fatorial</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Autor</div>
    <div class="quarto-title-meta-contents">
             <p>Daniel Reis </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Data de Publicação</div>
    <div class="quarto-title-meta-contents">
      <p class="date">1 de janeiro de 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introdução" class="level1">
<h1>Introdução</h1>
<p>A análise de componentes principais (PCA) e a análise fatorial (FA) são técnicas multivariadas amplamente utilizadas para lidar com a alta dimensionalidade dos dados, um problema conhecido como a “maldição da dimensionalidade” (Bellman, 1961). Esse fenômeno ocorre quando o excesso de variáveis dificulta a interpretação inicial dos dados e a aplicação de outras técnicas estatísticas. Ambas as metodologias têm como objetivo reduzir a complexidade dos dados enquanto capturam a estrutura subjacente, mas diferem em seus propósitos e abordagens.</p>
<p>A PCA é uma técnica que visa reduzir a dimensionalidade de um conjunto de dados multivariados, mantendo o máximo possível da variância original. Ela transforma as variáveis originais em um novo conjunto de variáveis, chamadas Componentes Principais, que são combinações lineares das variáveis originais, cujas características principais são:</p>
<ol type="1">
<li>São não correlacionadas entre si.<br>
</li>
<li>São ordenadas de forma que as primeiras capturam a maior parte da variância dos dados.<br>
</li>
<li>Servem como substitutas para as variáveis originais, simplificando análises, visualizações e aplicações subsequentes.</li>
</ol>
<p>O principal benefício da PCA é permitir que um pequeno número de componentes represente de maneira eficiente a variabilidade presente em um conjunto de dados de alta dimensionalidade. Isso facilita a identificação de padrões, a criação de gráficos e até mesmo a execução de outras análises estatísticas.</p>
<p>Já a FA compartilha da ideia de reduzir a complexidade dos dados, mas vai além ao buscar uma explicação teórica para as correlações entre as variáveis. Seu objetivo é identificar um conjunto menor de fatores subjacentes, não observáveis, que expliquem as relações entre as variáveis. O modelo fatorial parte da premissa de que:</p>
<ol type="1">
<li>Variáveis altamente correlacionadas pertencem a um mesmo grupo.<br>
</li>
<li>Grupos distintos apresentam correlações mais fracas entre si.<br>
</li>
<li>Cada grupo de variáveis representa um único constructo subjacente ou fator responsável pelas correlações observadas.</li>
</ol>
<p>Diferentemente da PCA, a FA assume uma estrutura mais elaborada, onde a matriz de covariância é modelada com base em fatores subjacentes e suas variâncias específicas. A questão central da análise fatorial é verificar se os dados são consistentes com a estrutura proposta pelo modelo.</p>
<p>Embora a PCA e a análise fatorial tenham objetivos e abordagens distintas, ambas são ferramentas essenciais para explorar e interpretar conjuntos de dados complexos. A PCA é particularmente útil quando a redução de dimensionalidade é o foco principal, enquanto a FA é preferida em contextos que exigem a identificação de estruturas teóricas subjacentes. Juntas, essas técnicas oferecem uma base poderosa para a compreensão de relações multivariadas.</p>
<p><br></p>
<section id="análise-fatorial-fa" class="level2">
<h2 class="anchored" data-anchor-id="análise-fatorial-fa">Análise Fatorial (FA)</h2>
<p>Vamos considerar a estrutura de um modelo de fatores ortogonais:</p>
<p>Suponha que temos um conjunto <strong>X</strong> de p variáveis com média <span class="math inline">\(\mu\)</span> e uma matriz de covariância <span class="math inline">\(\Sigma\)</span>. O modelo FA postula que <strong>X</strong> é linearmente dependente de um conjunto menor de m fatores latentes <span class="math inline">\(F_1, F_2, ..., F_m\)</span> denomindos fatores comuns e p fontes adicionais de fatores específicos que são fontes de variação <span class="math inline">\(\varepsilon_1, \varepsilon_2, ..., \varepsilon_p\)</span>. Assim temos:</p>
<p><span class="math display">\[\begin{align}
  X_1 - \mu_1 &amp;= l_{11}F_1 + l_{12}F_2 + ... + l_{1m}F_m + \varepsilon_1 \\
  X_2 - \mu_2 &amp;= l_{21}F_1 + l_{22}F_2 + ... + l_{2m}F_m + \varepsilon_2 \\
  \vdots \\
  X_p - \mu_p &amp;= l_{p1}F_1 + l_{p2}F_2 + ... + l_{pm}F_m + \varepsilon_p
\end{align}\]</span></p>
<p>Em notação matricial temos:</p>
<p><span class="math display">\[
X{\underset{(p \times 1)}{}} = \mu{\underset{(p \times 1)}{}} + L{\underset{(p \times m)}{}} F{\underset{(m \times 1)}{}} + \varepsilon{\underset{(p \times 1)}{}}
\]</span></p>
<p>Onde:</p>
<p><span class="math display">\[\begin{align}

\mu_i &amp;= \text{média da i-ésima variável} \\
\varepsilon_i &amp;= \text{fator específico da i-ésima variável} \\
F_j &amp;= \text{j-ésimo fator comum} \\
l_{ij} &amp;= \text{loading da i-ésima variável no j-ésimo fator}

\end{align}\]</span></p>
<p>Onde os vetores aleatórios <strong>F</strong> e <span class="math inline">\(\varepsilon\)</span> satisfazem as seguintes condições:</p>
<ol type="1">
<li><span class="math inline">\(F\)</span> e <span class="math inline">\(\varepsilon\)</span> são independentes</li>
<li><span class="math inline">\(E[F] = 0\)</span> e <span class="math inline">\(Cov(F) = I\)</span></li>
<li><span class="math inline">\(E[\varepsilon] = 0\)</span> e <span class="math inline">\(Cov(\varepsilon) = \Psi\)</span> (onde <span class="math inline">\(\Psi\)</span> é uma matriz diagonal)<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ol>
<p>Em muitos casos é de suma importância recuperar a matriz de covariância das variáveis <strong>X</strong> em termos de fatores ou melhor loadings, que é dada por:</p>
<p><span class="math display">\[\begin{align}
  Cov(X) = \Sigma = E[(X - \mu)(X - \mu)'] = LL' + \Psi
\end{align}\]</span></p>
<p>Em cada variável, vejamos como a sua variância é explicada por dois componentes denominados <em>communality</em> e <em>uniqueness</em>:</p>
<p><span class="math display">\[\begin{align}
   \underbrace{\sigma_{ii}}_\text{Var(X)} &amp;= \underbrace{l_{i,1}^2 + l_{i,2}^2 + ... + l_{i,m}^2}_\text{communality} + \underbrace{\psi_i}_\text{uniqueness} \\
   &amp;= h_i^2 + \psi_i, \quad i = 1, 2,..., p
\end{align}\]</span></p>
<p>Assim, o modelo de fatores supõe que <span class="math inline">\(p(p+1)/2\)</span> variâncias e covariâncias de <span class="math inline">\(X\)</span> possam ser reproduzidas por <span class="math inline">\(pm\)</span> <em>loadings</em> (<span class="math inline">\(l_{ij}\)</span>) e <span class="math inline">\(p\)</span> variâncias específicas <span class="math inline">\(\psi_i\)</span>. Quando <span class="math inline">\(m = p\)</span> a matriz de covariância de <span class="math inline">\(X\)</span> dada por <span class="math inline">\(\Sigma\)</span> pode ser representada exclusivamente por <span class="math inline">\(LL'\)</span> sendo <span class="math inline">\(\Psi\)</span> uma matriz nula. Quando <span class="math inline">\(m &lt;&lt; p\)</span> temos que o modelo de fatores proporciona uma maneira simples de representar a covariância de <span class="math inline">\(X\)</span> com menos parâmetros. Por exemplo, se temos <span class="math inline">\(p = 12\)</span> e <span class="math inline">\(m = 2\)</span> descrevemos os <span class="math inline">\(12\times(13)/2 = 78\)</span> elementos de <span class="math inline">\(\Sigma\)</span> por meio de <span class="math inline">\(12\times 2 + 12 = 36\)</span> parâmetros.</p>
</section>
</section>
<section id="aplicação-em-finanças" class="level1">
<h1>Aplicação em Finanças</h1>
<p>https://www.kaggle.com/code/lmglegro/factor-analysis/notebook</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.warning4.0"</span><span class="ot">=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="st">"getSymbols.yahoo.warning"</span><span class="ot">=</span><span class="cn">TRUE</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"C:/Users/estev/Documents/Projetos/dlpersite/preamble.R"</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'readr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'blogdown' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggplot2' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'plotly' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'plotly'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    last_plot</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    filter</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    layout</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'lubridate' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'DescTools'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:forecast':

    BoxCox</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:DescTools':

    %like%</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: PerformanceAnalytics</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'PerformanceAnalytics' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: xts</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'xts'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:data.table':

    first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'PerformanceAnalytics'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:graphics':

    legend</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: quantmod</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'quantmod' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Carregando pacotes exigidos: TTR</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'tidyquant'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:DescTools':

    IRR, NPV, PMT</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.0.0 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.5     ✔ rsample      1.1.1
✔ dials        1.1.0     ✔ tibble       3.2.1
✔ dplyr        1.1.4     ✔ tidyr        1.3.1
✔ infer        1.0.4     ✔ tune         1.0.1
✔ modeldata    1.0.1     ✔ workflows    1.1.2
✔ parsnip      1.0.3     ✔ workflowsets 1.0.0
✔ purrr        1.0.2     ✔ yardstick    1.1.0
✔ recipes      1.0.3     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'broom' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'scales' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'dplyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'purrr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tibble' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ yardstick::accuracy() masks forecast::accuracy()
✖ dplyr::between()      masks data.table::between()
✖ purrr::discard()      masks scales::discard()
✖ dplyr::filter()       masks plotly::filter(), stats::filter()
✖ dplyr::first()        masks xts::first(), data.table::first()
✖ dplyr::lag()          masks stats::lag()
✖ dplyr::last()         masks xts::last(), data.table::last()
✖ dials::momentum()     masks TTR::momentum()
✖ infer::observe()      masks shiny::observe()
✖ yardstick::spec()     masks readr::spec()
✖ recipes::step()       masks stats::step()
✖ purrr::transpose()    masks data.table::transpose()
• Use suppressPackageStartupMessages() to eliminate package startup messages</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'corrplot' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.92 loaded</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'psych' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'psych'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:scales':

    alpha, rescale</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:DescTools':

    AUC, ICC, SD</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:ggplot2':

    %+%, alpha</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'GPArotation' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'GPArotation'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:psych':

    equamax, varimin</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'ggpubr' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ggpubr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:forecast':

    gghistogram</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'tidyverse' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'forcats' was built under R version 4.2.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats 1.0.0     ✔ stringr 1.5.0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ psych::%+%()          masks ggplot2::%+%()
✖ psych::alpha()        masks scales::alpha(), ggplot2::alpha()
✖ dplyr::between()      masks data.table::between()
✖ scales::col_factor()  masks readr::col_factor()
✖ purrr::discard()      masks scales::discard()
✖ dplyr::filter()       masks plotly::filter(), stats::filter()
✖ dplyr::first()        masks xts::first(), data.table::first()
✖ stringr::fixed()      masks recipes::fixed()
✖ data.table::hour()    masks lubridate::hour()
✖ data.table::isoweek() masks lubridate::isoweek()
✖ dplyr::lag()          masks stats::lag()
✖ dplyr::last()         masks xts::last(), data.table::last()
✖ data.table::mday()    masks lubridate::mday()
✖ data.table::minute()  masks lubridate::minute()
✖ data.table::month()   masks lubridate::month()
✖ data.table::quarter() masks lubridate::quarter()
✖ data.table::second()  masks lubridate::second()
✖ yardstick::spec()     masks readr::spec()
✖ purrr::transpose()    masks data.table::transpose()
✖ data.table::wday()    masks lubridate::wday()
✖ data.table::week()    masks lubridate::week()
✖ data.table::yday()    masks lubridate::yday()
✖ data.table::year()    masks lubridate::year()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>ibov_tickers <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="st">"C:/Users/estev/Documents/Projetos/dlpersite/data/ibov_tickers.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>, <span class="at">escape_double =</span> <span class="cn">FALSE</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">trim_ws =</span> <span class="cn">TRUE</span>, <span class="at">skip =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">code =</span> <span class="dv">1</span>,  <span class="at">stock =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">tickers =</span> <span class="fu">paste0</span>(code, <span class="st">".SA"</span>),</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    code, </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    stock, </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">substr</span>(type, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">stop =</span> <span class="dv">2</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"ON"</span>, stock <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"AUTOMOB"</span>, <span class="st">"B3"</span>) <span class="sc">==</span> <span class="cn">FALSE</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: One or more parsing issues, call `problems()` on your data frame for details,
e.g.:
  dat &lt;- vroom(...)
  problems(dat)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 89 Columns: 6
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
chr (5): X1, X2, X3, X4, X5
lgl (1): X6

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>tickers <span class="ot">=</span> ibov_tickers<span class="sc">$</span>tickers</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>MDF <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tickers)){</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  aux <span class="ot">=</span> <span class="fu">getSymbols</span>(tickers[i],<span class="at">from =</span> <span class="st">'2005-01-01'</span>, <span class="at">to =</span> <span class="fu">today</span>(), <span class="at">warnings =</span> <span class="cn">FALSE</span>, <span class="at">auto.assign =</span> F)[,<span class="dv">6</span>]</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(aux) <span class="ot">&lt;-</span> tickers[i]</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  MDF <span class="ot">&lt;-</span> <span class="fu">cbind</span>(MDF, aux)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>tickers_na <span class="ot">=</span> <span class="fu">apply</span>(MDF, <span class="dv">2</span>, <span class="cf">function</span>(x)<span class="fu">sum</span>(<span class="fu">is.na</span>(x))) <span class="sc">==</span> <span class="dv">0</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>tickers_na <span class="ot">=</span> tickers_na[tickers_na <span class="sc">==</span> <span class="cn">TRUE</span>] <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>log_r <span class="ot">=</span> <span class="fu">diff</span>(<span class="fu">log</span>(MDF))[<span class="sc">-</span><span class="dv">1</span>, tickers_na]</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(log_r$VALE3.SA)</span></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co"># pairs(as.data.frame(log_r[,1:13]))</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>g1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>((log_r), <span class="fu">aes</span>(<span class="at">x=</span>log_r[,<span class="dv">1</span>], <span class="at">y=</span>log_r[,<span class="dv">2</span>])) <span class="sc">+</span> </span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> tickers[<span class="dv">1</span>], <span class="at">y =</span> tickers[<span class="dv">2</span>], <span class="at">title =</span> <span class="fu">paste0</span>(tickers[<span class="dv">1</span>], <span class="st">" Vs "</span>, tickers[<span class="dv">2</span>])) <span class="sc">+</span> </span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>g2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>((log_r), <span class="fu">aes</span>(<span class="at">x=</span>log_r[,<span class="dv">4</span>], <span class="at">y=</span>log_r[,<span class="dv">11</span>])) <span class="sc">+</span> </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm) <span class="sc">+</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> tickers[<span class="dv">4</span>], <span class="at">y =</span> tickers[<span class="dv">11</span>], <span class="at">title =</span> <span class="fu">paste0</span>(tickers[<span class="dv">4</span>], <span class="st">" Vs "</span>, tickers[<span class="dv">11</span>])) <span class="sc">+</span> </span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>fig <span class="ot">&lt;-</span> <span class="fu">ggarrange</span>(g1, g2,<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"(A)"</span>, <span class="st">"(B)"</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="dv">1</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Don't know how to automatically pick scale for object of type &lt;xts/zoo&gt;.
Defaulting to continuous.
Don't know how to automatically pick scale for object of type &lt;xts/zoo&gt;.
Defaulting to continuous.
`geom_smooth()` using formula = 'y ~ x'
Don't know how to automatically pick scale for object of type &lt;xts/zoo&gt;.
Defaulting to continuous.
Don't know how to automatically pick scale for object of type &lt;xts/zoo&gt;.
Defaulting to continuous.
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate_figure</span>(fig,</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">top =</span> <span class="fu">text_grob</span>(<span class="st">"Return v Return plot"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">30</span>))</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pca_fa_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>corr <span class="ot">&lt;-</span> <span class="fu">cor</span>(log_r, <span class="at">use =</span> <span class="st">"pair"</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(corr, <span class="at">method =</span> <span class="st">'square'</span>, <span class="at">type=</span><span class="st">"upper"</span>, <span class="at">order=</span><span class="st">"FPC"</span>, <span class="at">addCoef.col =</span> <span class="st">'black'</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pca_fa_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cortest.bartlett</span>(log_r <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>())</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>R was not square, finding R from data</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$chisq
[1] 25722.16

$p.value
[1] 0

$df
[1] 210</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KMO Test.</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">KMO</span>(log_r <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>())</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kaiser-Meyer-Olkin factor adequacy
Call: KMO(r = log_r %&gt;% na.omit())
Overall MSA =  0.94
MSA for each item = 
ABEV3.SA BBDC3.SA BBAS3.SA BRFS3.SA CCRO3.SA CPFE3.SA CYRE3.SA ELET3.SA 
    0.96     0.93     0.93     0.97     0.96     0.96     0.96     0.96 
EMBR3.SA EGIE3.SA LREN3.SA PCAR3.SA PETR3.SA RADL3.SA SBSP3.SA CSNA3.SA 
    0.96     0.95     0.95     0.89     0.94     0.95     0.97     0.89 
SUZB3.SA VIVT3.SA UGPA3.SA VALE3.SA WEGE3.SA 
    0.79     0.96     0.80     0.86     0.96 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.parallel</span>(log_r, <span class="at">fa =</span> <span class="st">'fa'</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Parallel analysis suggests that the number of factors =  5  and the number of components =  NA </code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">4</span>,<span class="dv">10</span>, <span class="at">col =</span> <span class="st">'black'</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pca_fa_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>fa_none <span class="ot">=</span> <span class="fu">factanal</span>(log_r, <span class="dv">3</span>, <span class="at">rotation =</span> <span class="st">'none'</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fa_none,<span class="at">cutoff =</span> <span class="fl">0.1</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
factanal(x = log_r, factors = 3, rotation = "none")

Uniquenesses:
ABEV3.SA BBDC3.SA BBAS3.SA BRFS3.SA CCRO3.SA CPFE3.SA CYRE3.SA ELET3.SA 
   0.675    0.370    0.264    0.760    0.583    0.941    0.592    0.630 
EMBR3.SA EGIE3.SA LREN3.SA PCAR3.SA PETR3.SA RADL3.SA SBSP3.SA CSNA3.SA 
   0.786    0.706    0.973    0.986    0.490    0.868    0.628    0.443 
SUZB3.SA VIVT3.SA UGPA3.SA VALE3.SA WEGE3.SA 
   0.998    0.829    0.997    0.181    0.756 

Loadings:
         Factor1 Factor2 Factor3
ABEV3.SA  0.502   0.143   0.228 
BBDC3.SA  0.754   0.236         
BBAS3.SA  0.765   0.280  -0.271 
BRFS3.SA  0.441   0.123   0.175 
CCRO3.SA  0.581   0.250   0.131 
CPFE3.SA  0.218                 
CYRE3.SA  0.600   0.207         
ELET3.SA  0.565   0.222         
EMBR3.SA  0.417           0.195 
EGIE3.SA  0.479   0.224   0.119 
LREN3.SA  0.145                 
PCAR3.SA                        
PETR3.SA  0.708                 
RADL3.SA  0.293   0.130   0.172 
SBSP3.SA  0.575   0.171   0.109 
CSNA3.SA  0.697  -0.268         
SUZB3.SA                        
VIVT3.SA  0.372   0.128   0.129 
UGPA3.SA                        
VALE3.SA  0.734  -0.529         
WEGE3.SA  0.431           0.224 

               Factor1 Factor2 Factor3
SS loadings      5.365   0.816   0.365
Proportion Var   0.255   0.039   0.017
Cumulative Var   0.255   0.294   0.312

Test of the hypothesis that 3 factors are sufficient.
The chi square statistic is 493.46 on 150 degrees of freedom.
The p-value is 3.2e-38 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fa_none<span class="sc">$</span>loadings[,<span class="dv">1</span>],<span class="at">type=</span><span class="st">"b"</span>,<span class="at">ylab=</span><span class="st">"PC"</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.4</span>,<span class="dv">2</span>),<span class="at">main=</span><span class="st">"Factor Loadings None rotation"</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fa_none<span class="sc">$</span>loadings[,<span class="dv">2</span>],<span class="at">type=</span><span class="st">"b"</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(fa_none<span class="sc">$</span>loadings[,<span class="dv">3</span>],<span class="at">type=</span><span class="st">"b"</span>,<span class="at">lty=</span><span class="dv">3</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>,<span class="dv">0</span><span class="sc">*</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">14</span>))</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>,<span class="fu">c</span>(<span class="st">"FA1"</span>,<span class="st">"FA2"</span>,<span class="st">"FA3"</span>),<span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">cex=</span><span class="dv">1</span>,<span class="at">col=</span><span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">7.5</span>,<span class="sc">-</span><span class="fl">1.25</span>, </span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">'1:MFC   2:PRU   3:MET   4:V   5:GS    6:MS    7:C     8:WFC   9:BAC   10:JPM   11:GNW   12:BAM   13:RVT   14:BLK'</span>,</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex=</span><span class="fl">1.5</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pca_fa_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>factor.model <span class="ot">&lt;-</span> <span class="fu">fa</span>(log_r, <span class="at">nfactors =</span> <span class="dv">3</span>, <span class="at">fm=</span><span class="st">"ols"</span>, <span class="at">max.iter =</span> <span class="dv">100</span>, <span class="at">rotate =</span> <span class="st">"none"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(factor.model)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pca_fa_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>fa_obli <span class="ot">=</span> <span class="fu">factanal</span>(log_r[ , <span class="dv">1</span><span class="sc">:</span><span class="dv">13</span>], <span class="dv">3</span>, <span class="at">rotation =</span> <span class="st">'oblimin'</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(fa_obli,<span class="at">cutoff =</span> <span class="fl">0.1</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
factanal(x = log_r[, 1:13], factors = 3, rotation = "oblimin")

Uniquenesses:
ABEV3.SA BBDC3.SA BBAS3.SA BRFS3.SA CCRO3.SA CPFE3.SA CYRE3.SA ELET3.SA 
   0.691    0.367    0.244    0.749    0.601    0.941    0.585    0.642 
EMBR3.SA EGIE3.SA LREN3.SA PCAR3.SA PETR3.SA 
   0.755    0.005    0.974    0.983    0.567 

Loadings:
         Factor1 Factor2 Factor3
ABEV3.SA          0.486         
BBDC3.SA  0.584   0.232         
BBAS3.SA  0.909                 
BRFS3.SA          0.460         
CCRO3.SA  0.228   0.389   0.102 
CPFE3.SA          0.156         
CYRE3.SA  0.287   0.391         
ELET3.SA  0.302   0.261   0.132 
EMBR3.SA          0.544         
EGIE3.SA                  1.002 
LREN3.SA          0.108         
PCAR3.SA          0.163         
PETR3.SA  0.478   0.239         

               Factor1 Factor2 Factor3
SS loadings      1.635   1.294   1.052
Proportion Var   0.126   0.100   0.081
Cumulative Var   0.126   0.225   0.306

Factor Correlations:
        Factor1 Factor2 Factor3
Factor1   1.000   0.457   0.418
Factor2   0.457   1.000   0.738
Factor3   0.418   0.738   1.000

Test of the hypothesis that 3 factors are sufficient.
The chi square statistic is 142.57 on 42 degrees of freedom.
The p-value is 7.16e-13 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">na.omit</span>(fa_obli<span class="sc">$</span>loadings[,<span class="dv">1</span>]),<span class="at">type=</span><span class="st">"b"</span>,<span class="at">ylab=</span><span class="st">"PC"</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.4</span>,<span class="dv">2</span>),<span class="at">main=</span><span class="st">"Factor Loadings Oblimin"</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">na.omit</span>(fa_obli<span class="sc">$</span>loadings[,<span class="dv">2</span>]),<span class="at">type=</span><span class="st">"b"</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">na.omit</span>(fa_obli<span class="sc">$</span>loadings[,<span class="dv">3</span>]),<span class="at">type=</span><span class="st">"b"</span>,<span class="at">lty=</span><span class="dv">3</span>,<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="st">"blue"</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">15</span>,<span class="dv">0</span><span class="sc">*</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">15</span>))</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"top"</span>,<span class="fu">c</span>(<span class="st">"Capital Markets and Banking Factor (F1)"</span>,<span class="st">"The Asset Management &amp; Credit Services Factor(F2)"</span>,<span class="st">"The insurance life Factor (F3)"</span>),<span class="at">lty=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">cex=</span><span class="dv">1</span>,<span class="at">col=</span><span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"blue"</span>))</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">7.5</span>,<span class="sc">-</span><span class="fl">1.25</span>, </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>     <span class="st">'1:MFC   2:PRU   3:MET   4:V   5:GS    6:MS    7:C     8:WFC   9:BAC   10:JPM   11:GNW   12:BAM   13:RVT   14:BLK'</span>,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex=</span><span class="fl">1.5</span>)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pca_fa_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>factor.model <span class="ot">&lt;-</span> psych<span class="sc">::</span><span class="fu">fa</span>(log_r, <span class="at">nfactors =</span> <span class="dv">4</span>, <span class="at">fm=</span><span class="st">"ols"</span>, <span class="at">max.iter =</span> <span class="dv">100</span>, <span class="at">rotate =</span> <span class="st">"oblimin"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(factor.model)</span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="pca_fa_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ecfac &lt;- read.csv('../input/factor-ana-data/econfa.csv')</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mrkp = as.matrix(ecfac$log_mkt_pr[1:133])</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># int_r = as.matrix(ecfac$Interest.Rate[1:133])</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mrkp = as.data.frame(mrkp[-1])</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co"># int_r = as.data.frame((int_r[-1]))</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ecfac &lt;- cbind(mrkp,int_r)</span></span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a><span class="co"># colnames(ecfac) &lt;- c('log_rmktp','Int_r')</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a><span class="co"># head(ecfac)</span></span></code><button title="Copiar para a área de transferência" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Notas de rodapé</h2>

<ol>
<li id="fn1"><p>Em contraste com o modelo de fatores oblíquos nos quais os faotres <strong>F</strong> podem ser correlacionados de modo que a matriz de <strong>Cov(F)</strong> não é diagonal.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>